---
const currentPath = Astro.url.pathname;

// Estructura de menús con submenús
const menuItems = [
  { name: 'Inicio', href: '/', subItems: [] },
  {
    name: 'Nosotros',
    href: '/nosotros',
    subItems: [
      { name: 'Bienvenido', href: '/nosotros/bienvenido' },
      { name: 'Misión y Visión', href: '/nosotros/mision-vision' },
      { name: 'Filosofía', href: '/nosotros/filosofia' },
      { name: 'Campus', href: '/nosotros/campus' },
    ]
  },
  {
    name: 'Niveles',
    href: '/niveles',
    subItems: [
      { name: 'Primaria', href: '/niveles/primaria' },
      { name: 'Secundaria', href: '/niveles/secundaria' },
    ]
  },
  {
    name: 'Admisión',
    href: '/admision',
    subItems: [
      { name: 'Admisión-Matrícula', href: '/admision/matricula' },
      { name: 'Costos', href: '/admision/costos' },
      { name: 'Formas de pago', href: '/admision/formas-pago' },
    ]
  },
  { name: 'Logros', href: '/logros', subItems: [] },
];

// Elementos para el menú "Más"
const moreMenuItems = [
  {
    name: 'Talleres',
    href: '/talleres',
    subItems: [
      { name: 'Artísticos', href: '/talleres/artisticos' },
      { name: 'Deportivos', href: '/talleres/deportivos' },
    ]
  },
  {
    name: 'Logros',
    href: '/logros',
    subItems: [
      { name: 'Académicos', href: '/logros/academicos' },
      { name: 'Empresariales', href: '/logros/empresariales' },
      { name: 'Deportivos', href: '/logros/deportivos' },
    ]
  },
];
---

<nav id="navbar" class="fixed top-0 w-full z-[100] transition-all duration-500 bg-colegio-blue/95 backdrop-blur-lg border-b border-white/10">
  <!-- Franja superior -->
  
  <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
    <div class="flex h-20 md:h-22 lg:h-24 items-center justify-between gap-4">
      
      <!-- Logo con animación - Alineado a la izquierda -->
      <a href="/" class="flex-shrink-0 flex items-center gap-2 lg:gap-3 group">
        <img 
          src="/LOGO BLANCO.webp" 
          alt="BRÜNING SCHOOL" 
          class="h-12 sm:h-13 md:h-14 lg:h-16 xl:h-18 w-auto object-contain group-hover:scale-105 transition-transform duration-300"
        />
      </a>

      <!-- Desktop Menu - Centrado -->
      <div class="hidden lg:flex lg:space-x-0.5 xl:space-x-1 items-center flex-1 justify-center">
        {menuItems.map((item) => {
          const isActive = currentPath === item.href || item.subItems.some(sub => currentPath === sub.href);
          const hasSubmenu = item.subItems.length > 0;
          
          return (
            <div class="relative group flex-shrink-0">
              {hasSubmenu ? (
                <button 
                  class={`nav-link relative text-white/90 font-bold text-sm lg:text-sm xl:text-lg px-2.5 lg:px-3 xl:px-5 py-2.5 lg:py-3 rounded-lg transition-all duration-300 flex items-center gap-1 whitespace-nowrap ${isActive ? 'text-colegio-yellow' : 'hover:text-white hover:bg-white/10'}`}
                >
                  {item.name}
                  <svg class="w-3.5 h-3.5 xl:w-5 xl:h-5 transition-transform duration-200 group-hover:rotate-180" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                  <span class={`nav-underline ${isActive ? 'active' : ''}`}></span>
                </button>
              ) : (
                <a 
                  href={item.href} 
                  class={`nav-link relative text-white/90 font-bold text-sm lg:text-sm xl:text-lg px-2.5 lg:px-3 xl:px-5 py-2.5 lg:py-3 rounded-lg transition-all duration-300 whitespace-nowrap ${isActive ? 'text-colegio-yellow' : 'hover:text-white hover:bg-white/10'}`}
                >
                  {item.name}
                  <span class={`nav-underline ${isActive ? 'active' : ''}`}></span>
                </a>
              )}
              
              {hasSubmenu && (
                <div class="submenu absolute left-0 top-full mt-2 w-56 xl:w-64 bg-white rounded-xl shadow-2xl border border-gray-100 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-300 transform -translate-y-2 group-hover:translate-y-0 overflow-hidden">
                  <div class="py-2">
                    {item.subItems.map((subItem, index) => {
                      const isSubActive = currentPath === subItem.href;
                      return (
                        <a 
                          href={subItem.href}
                          class={`block px-4 xl:px-5 py-2.5 xl:py-3 text-sm lg:text-sm xl:text-base font-medium transition-all duration-200 ${
                            isSubActive 
                              ? 'bg-colegio-blue text-white' 
                              : 'text-gray-700 hover:bg-colegio-blue/10 hover:text-colegio-blue hover:pl-5 xl:hover:pl-6'
                          }`}
                        >
                          {subItem.name}
                        </a>
                      );
                    })}
                  </div>
                </div>
              )}
            </div>
          );
        })}
        
        <!-- Botón Más (Desktop) -->
        <button 
          id="sidebar-open-btn"
          class="nav-link relative text-white/90 font-bold text-sm lg:text-sm xl:text-lg px-2.5 lg:px-3 xl:px-5 py-2.5 lg:py-3 rounded-lg transition-all duration-300 hover:text-white hover:bg-white/10 flex items-center gap-1 xl:gap-2 whitespace-nowrap flex-shrink-0"
        >
          <span>Más</span>
          <svg class="w-3.5 h-3.5 xl:w-5 xl:h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 5v.01M12 12v.01M12 19v.01M12 6a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2zm0 7a1 1 0 110-2 1 1 0 010 2z"></path>
          </svg>
        </button>
      </div>

      <div class="flex items-center gap-2 sm:gap-3 md:gap-4 relative z-10">
        <!-- Botón Aula Virtual mejorado -->
        <a 
          href="https://campusschool.bruningcolegio.edu.pe/login/index.php" 
          target="_blank"
          class="bg-gradient-to-r from-colegio-yellow to-yellow-400 text-colegio-blue px-3 sm:px-4 md:px-6 py-2 md:py-2.5 rounded-full font-bold hover:shadow-2xl hover:scale-105 transition-all duration-300 flex items-center gap-1.5 sm:gap-2 shadow-lg text-xs sm:text-sm md:text-base whitespace-nowrap"
        >
          <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4 sm:h-5 sm:w-5 md:h-6 md:w-6 flex-shrink-0" viewBox="0 0 20 20" fill="currentColor">
            <path d="M10.394 2.827a1 1 0 00-.788 0l-7 3a1 1 0 000 1.848l.788.338v3.656a1 1 0 00.553.894l4.5 2.25a1 1 0 00.894 0l4.5-2.25a1 1 0 00.553-.894V8.013l.788-.338a1 1 0 000-1.848l-7-3zM7.333 11.5l3.277 1.639 3.277-1.639V8.834l-3.277 1.405a1 1 0 01-.788 0L7.333 8.834V11.5z" />
          </svg>
          <span class="hidden sm:inline">Aula Virtual</span>
        </a>

        <!-- Hamburger Menu Button (Mobile/Tablet) -->
        <button id="mobile-menu-button" class="lg:hidden text-white p-1.5 sm:p-2 hover:bg-white/10 rounded-lg transition-all flex-shrink-0">
          <svg id="menu-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7 md:h-8 md:w-8 transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16m-7 6h7" />
          </svg>
          <svg id="close-icon" xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 sm:h-7 sm:w-7 md:h-8 md:w-8 hidden transition-transform duration-300" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
          </svg>
        </button>
      </div>
    </div>
  </div>
  <!-- Franja inferior -->
  <div class="w-full h-0.5 bg-[#FFFFFF]"></div>

  <!-- Mobile Menu -->
  <div id="mobile-menu" class="lg:hidden hidden bg-colegio-blue/98 backdrop-blur-xl border-t border-white/10">
    <div class="px-4 pt-2 pb-4 space-y-2 max-w-md mx-auto">
      {menuItems.map((item, itemIndex) => {
        const isActive = currentPath === item.href || item.subItems.some(sub => currentPath === sub.href);
        const hasSubmenu = item.subItems.length > 0;
        
        return (
          <div class="mobile-menu-item">
            {hasSubmenu ? (
              <>
                <button 
                  class={`mobile-menu-toggle w-full flex items-center justify-between text-white font-semibold px-4 py-3 rounded-lg transition-all hover:bg-white/10 text-left ${isActive ? 'bg-white/20 text-colegio-yellow' : ''}`}
                  data-menu-index={itemIndex}
                >
                  <span class="text-base">{item.name}</span>
                  <svg class="w-5 h-5 transition-transform duration-200 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path>
                  </svg>
                </button>
                <div class="mobile-submenu hidden mt-1 space-y-1 bg-white/5 rounded-lg p-2">
                  {item.subItems.map((subItem) => {
                    const isSubActive = currentPath === subItem.href;
                    return (
                      <a 
                        href={subItem.href}
                        class={`block text-sm px-4 py-2.5 rounded-lg transition-all text-left ${
                          isSubActive 
                            ? 'bg-colegio-yellow/20 text-colegio-yellow font-semibold' 
                            : 'text-white/80 hover:bg-white/10 hover:text-white'
                        }`}
                      >
                        {subItem.name}
                      </a>
                    );
                  })}
                </div>
              </>
            ) : (
              <a 
                href={item.href}
                class={`block text-white font-semibold px-4 py-3 rounded-lg transition-all hover:bg-white/10 text-left text-base ${isActive ? 'bg-white/20 text-colegio-yellow' : ''}`}
              >
                {item.name}
              </a>
            )}
          </div>
        );
      })}
      
      <!-- Botón Ver Más en Mobile -->
      <button 
        id="mobile-sidebar-btn"
        class="w-full flex items-center justify-between text-white font-semibold px-4 py-3 rounded-lg transition-all hover:bg-white/10 border border-colegio-yellow/30 bg-colegio-yellow/10 mt-3"
      >
        <span class="flex items-center gap-2">
          <svg class="w-5 h-5 flex-shrink-0" fill="currentColor" viewBox="0 0 20 20">
            <path d="M5 3a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2V5a2 2 0 00-2-2H5zM5 11a2 2 0 00-2 2v2a2 2 0 002 2h2a2 2 0 002-2v-2a2 2 0 00-2-2H5zM11 5a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2V5zM11 13a2 2 0 012-2h2a2 2 0 012 2v2a2 2 0 01-2 2h-2a2 2 0 01-2-2v-2z"/>
          </svg>
          <span class="text-sm sm:text-base">Ver Más Opciones</span>
        </span>
        <span class="bg-colegio-yellow text-colegio-blue text-xs font-bold px-2 py-1 rounded-full flex-shrink-0">+12</span>
      </button>
    </div>
  </div>
</nav>

<style>
  .nav-underline {
    position: absolute;
    bottom: 0;
    left: 50%;
    width: 0;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--color-colegio-yellow), transparent);
    transform: translateX(-50%);
    transition: width 0.3s ease;
  }

  .nav-link:hover .nav-underline,
  .nav-underline.active {
    width: 100%;
  }

  #navbar.scrolled {
    background-color: rgb(0 51 153 / 0.98);
    box-shadow: 0 25px 50px -12px rgb(0 0 0 / 0.25);
  }

  /* Submenu styles */
  .submenu {
    z-index: 1000;
  }

  .group:hover .submenu {
    pointer-events: auto;
  }

  /* Mobile submenu animation */
  .mobile-submenu {
    max-height: 0;
    overflow: hidden;
    transition: max-height 0.3s ease-out;
  }

  .mobile-submenu.open {
    max-height: 500px;
  }
</style>

<script>
  // Scroll effect
  let lastScroll = 0;
  const navbar = document.getElementById('navbar');
  
  window.addEventListener('scroll', () => {
    const currentScroll = window.pageYOffset;
    
    if (currentScroll > 50) {
      navbar?.classList.add('scrolled');
    } else {
      navbar?.classList.remove('scrolled');
    }
    
    lastScroll = currentScroll;
  });

  // Mobile menu toggle
  const mobileMenuButton = document.getElementById('mobile-menu-button');
  const mobileMenu = document.getElementById('mobile-menu');
  const menuIcon = document.getElementById('menu-icon');
  const closeIcon = document.getElementById('close-icon');

  mobileMenuButton?.addEventListener('click', () => {
    mobileMenu?.classList.toggle('hidden');
    menuIcon?.classList.toggle('hidden');
    closeIcon?.classList.toggle('hidden');
  });

  // Mobile submenu toggles
  document.querySelectorAll('.mobile-menu-toggle').forEach((toggle) => {
    toggle.addEventListener('click', (e) => {
      const submenu = toggle.nextElementSibling as HTMLElement;
      const icon = toggle.querySelector('svg');
      
      if (submenu && submenu.classList.contains('mobile-submenu')) {
        submenu.classList.toggle('hidden');
        submenu.classList.toggle('open');
        icon?.classList.toggle('rotate-180');
      }
    });
  });

  // Sidebar toggle (Desktop)
  const sidebarOpenBtn = document.getElementById('sidebar-open-btn');
  sidebarOpenBtn?.addEventListener('click', () => {
    if ((window as any).openSidebar) {
      (window as any).openSidebar();
    }
  });

  // Sidebar toggle (Mobile)
  const mobileSidebarBtn = document.getElementById('mobile-sidebar-btn');
  mobileSidebarBtn?.addEventListener('click', () => {
    // Cerrar el menú móvil primero
    mobileMenu?.classList.add('hidden');
    menuIcon?.classList.remove('hidden');
    closeIcon?.classList.add('hidden');
    
    // Abrir el sidebar
    if ((window as any).openSidebar) {
      (window as any).openSidebar();
    }
  });
</script>